# Compare peptigate human peptide predictions against RibORF predictions

A recent paper, ["Widespread stable noncanonical peptides identified by integrated analyses of ribosome profiling and ORF features](https://doi.org/10.1038/s41467-024-46240-9) developed a tool called RibORF to carefully predict open reading frames (ORFs) from ribosome profiling data.
Ribosome profiling data is generated by sequencing fragments of mRNA that are protected by ribosomes, offering a snapshot of translation in action at a given moment.
This technique precisely determines which regions of mRNA are being actively translated into proteins, providing insights into gene expression and the regulation of protein synthesis.
The paper used their RibORF tool on hundreds of human ribosomal profiling data sets and predicted ORFs from that data.

In this directoy, we compare the peptigate peptide predictions against peptide sequences predicted from ribosomal profiling data with RibORF.
See the [notebook](./20240329-peptigate-vs-riborf-predictions.ipynb) in this folder for a comparison on the two techniques.
The rest of this README documents how I obtained the RibORF predictions for the human genome and then compared the peptigate results against them.

## Determine RibORF prediction sequences from information published in the RibORF paper

Activate the conda environment created in the main README (from [`envs/dev.yml`](../envs/dev.yml).
```bash
conda activate pepeval
```

Download the supplementary table from RibORF that details the names of the predicted ORFs

```bash
curl -JLO https://static-content.springer.com/esm/art%3A10.1038%2Fs41467-024-46240-9/MediaObjects/41467_2024_46240_MOESM6_ESM.xlsx
```

Extract xlsx sheet with the human data to a TSV file (technically a bed file).
While we only focus on the human data, the sheet names are human, mouse, zebrafish, worm, yeast.

```bash
xlsx2csv -n human -d "\t" 41467_2024_46240_MOESM6_ESM.xlsx riborf_human.bed
```

Extract the names of the ORFs from the TSV/bed file.
These are the names of the predicted sequences.
In a few steps, we'll use these to extract the actual sequences.

```bash
cut -f4 riborf_human.bed > riborf_human_names.txt
```

Download human reference files

```bash
curl -O ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_39/GRCh38.primary_assembly.genome.fa.gz
curl -O ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_39/gencode.v39.annotation.gtf.gz
```

Run `genepred` on the human GTF file.
This reformats the GTF file into a genePred file, which is needed by the RibORF ORF prediction tool.

```bash
mamba env create -n gtftogenepred -f ../envs/gtftogenepred.yml
conda activate gtftogenepred
gtfToGenePred gencode.v39.annotation.gtf gencode.v39.annotation.genePred.txt
conda deactivate
```

Download the RibORF ORF annotation script.

```bash
curl -JLO https://raw.githubusercontent.com/zhejilab/RibORF/master/RibORF.2.0/ORFannotate.pl
```

Use the RibORF script to predict all ORFs in the human genome, using the same version of the genome used in the RibORF paper.

```bash
perl ORFannotate.pl -g GRCh38.primary_assembly.genome.fa -t gencode.v39.annotation.genePred.txt -o outputDir
```

Extract the sequences of the predicted ORFs using the ORF names extracted from the supplementary table above and the predicted ORFs from the previous step.

```bash
seqtk subseq outputDir/candidateORF.fa riborf_human_names.txt > riborf_human_sequences.fasta
```

Translate the sequences into amino acids.

```bash
seqkit translate --trim -o riborf_human_sequences.faa riborf_human_sequences.fasta
```

## Compare the RibORF peptide predictions against the peptigate peptide sequences.

We compared the peptigate peptide predictions against the RibORF predictions by BLASTp-ing the peptigate predictions against the RibORF predictions.
For this test, peptigate was run from commit hash [37dacf](https://github.com/Arcadia-Science/peptigate/commit/37dacf77833e1188b831025416d3bde00edfdcc4).
The results are located in the [`../results/human`](../results/human) folder.

First, we made a blast database of the RibORF sequences.
```bash
makeblastdb -in riborf_human_sequences.faa  -dbtype prot -out riborf_human_sequences.faa
```

Then, we BLAST'd the peptigate predictions against the RibORF sequences
```bash
gunzip ../../peptigate/results/predictions/peptides.faa.gz
blastp -db riborf_human_sequences.faa -query ../../peptigate/results/predictions/peptides.faa -out peptigate_sequences_vs_riborf_blastp.tsv -max_target_seqs 5 -outfmt "6 qseqid qlen qseq sseqid slen sseq pident length mismatch gapopen qstart qend sstart send qcovhsp evalue bitscore"
```

These results are analyzed in the [notebook](./20240329-peptigate-vs-riborf-predictions.ipynb) in this directory.
